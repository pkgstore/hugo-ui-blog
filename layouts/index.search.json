{{ $cfg := (site.Params.search) }}

{{ if ($cfg.internal.enabled) }}
    {{ $pages := (where (site.RegularPages) "Type" "in" (site.Params.content.sections)) }}
    {{ $data := (newScratch) }}

    {{ ($data.Add "pages" slice) }}

    {{ range ($pages) }}
        {{ ($data.Add "pages" (dict
        "title" (.Title)
        "tags" (.Params.tags)
        "categories" (.Params.categories)
        "url" (.Permalink)
        "date" (.Date.Format "2006-01-02T15:04:05Z07:00")
        )) }}
    {{ end }}

    {{ $search := (($data.Get "pages") | uniq) }}

    {{ ((dict "data" ($search)) | jsonify) }}
{{ end }}
